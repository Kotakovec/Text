<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jednoduchý Word s Kódem a Modálním Editorem</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
  }
  .toolbar {
    background: #f0f0f0;
    padding: 10px;
    display: none; /* skrytý toolbar dokud není editmode */
    gap: 5px;
    flex-wrap: wrap;
  }
  .toolbar button, .toolbar select {
    padding: 5px;
  }
  #editor {
    flex: 1;
    padding: 20px;
    border: none;
    outline: none;
    overflow-y: auto;
    background: #fff;
    font-family: Arial, sans-serif;
    white-space: pre-wrap;
  }
  /* Styl pro code block */
  .code-block {
    background: #1e1e1e;
    color: #d4d4d4;
    font-family: 'Courier New', monospace;
    padding: 10px;
    display: flex;
    gap: 10px;
  }
  .line-numbers {
    text-align: right;
    user-select: none;
    color: #888;
  }
  .code-content {
    white-space: pre;
  }

  /* Modální okno */
  .modal {
    display: none;
    position: fixed;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 80%;
    background: #fff;
    border: 2px solid #000;
    z-index: 1000;
    flex-direction: column;
  }
  .modal-header {
    background: #f0f0f0;
    padding: 5px;
    display: flex;
    justify-content: flex-end;
  }
  .modal-body {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    border-top: 1px solid #ccc;
  }
  .close-btn {
    cursor: pointer;
    font-weight: bold;
  }
</style>
</head>
<body>

<div class="toolbar" id="toolbar">
  <button onclick="format('bold')"><b>B</b></button>
  <button onclick="format('underline')"><u>U</u></button>
  <select onchange="format('fontName', this.value)">
    <option value="">Font</option>
    <option value="Arial">Klasický</option>
    <option value="Courier New">Linux Terminal</option>
    <option value="monospace">Monospace</option>
  </select>
  <select onchange="format('fontSize', this.value)">
    <option value="">Velikost textu</option>
    <option value="1">10px</option>
    <option value="2">13px</option>
    <option value="3">16px</option>
    <option value="4">18px</option>
    <option value="5">24px</option>
    <option value="6">32px</option>
    <option value="7">48px</option>
  </select>
  <select onchange="format('foreColor', this.value)">
    <option value="">Barva textu</option>
    <option value="red">Červená</option>
    <option value="blue">Modrá</option>
    <option value="green">Zelená</option>
    <option value="black">Černá</option>
  </select>
  <button onclick="format('insertUnorderedList')">• List</button>
  <button onclick="format('insertOrderedList')">1. List</button>
  <button onclick="insertCode()">Vložit kód</button>
  <button onclick="openModalEditor()">Otevřít okno editoru</button>
</div>

<div id="editor" contenteditable="false"></div>

<!-- Modální okno -->
<div class="modal" id="modal">
  <div class="modal-header">
    <span class="close-btn" onclick="closeModal()">X</span>
  </div>
  <div class="modal-body" id="modal-editor" contenteditable="false" style="font-family: Arial, sans-serif; white-space: pre-wrap;"></div>
</div>

<script>
const editor = document.getElementById('editor');
const toolbar = document.getElementById('toolbar');
const modal = document.getElementById('modal');
const modalEditor = document.getElementById('modal-editor');

// Načtení uloženého textu při načtení stránky
window.onload = () => {
  const saved = localStorage.getItem('myWordContent');
  if(saved) editor.innerHTML = saved;
};

// Formátování
function format(command, value = null) {
  if(!editor.isContentEditable) return;
  document.execCommand(command, false, value);
  saveText();
}

// Automatické ukládání
editor.addEventListener('input', () => {
  if(editor.isContentEditable) saveText();
});
editor.addEventListener('keydown', handleKeys);

// Enter a Tab
function handleKeys(e) {
  if(!editor.isContentEditable) return;
  if(e.key === 'Enter') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '<br><br>');
    saveText();
  }
  if(e.key === 'Tab') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
    saveText();
  }
}

// Uložení
function saveText() {
  localStorage.setItem('myWordContent', editor.innerHTML);
}

// Tajný edit mode
window.editmode = () => {
  editor.setAttribute('contenteditable', 'true');
  toolbar.style.display = 'flex';
  modalEditor.setAttribute('contenteditable', 'true');
};

// Klávesová zkratka Ctrl+E na zapnutí edit mode
document.addEventListener('keydown', (e) => {
  if(e.ctrlKey && e.key.toLowerCase() === 'e') {
    e.preventDefault();
    editmode();
  }
});

// Vložení kódu
function insertCode() {
  if(!editor.isContentEditable) return;
  const code = prompt("Vlož sem svůj kód:");
  if(!code) return;
  const lines = code.split('\n');
  const lineNumbers = lines.map((_, i) => i + 1).join('<br>');
  const codeHTML = `
    <div class="code-block">
      <div class="line-numbers">${lineNumbers}</div>
      <div class="code-content">${lines.join('<br>')}</div>
    </div><br>
  `;
  editor.innerHTML += codeHTML;
  saveText();
}

// Otevření modálního editoru
function openModalEditor() {
  modal.style.display = 'flex';
  modalEditor.innerHTML = editor.innerHTML;

  modalEditor.addEventListener('input', () => {
    if(editor.isContentEditable) {
      editor.innerHTML = modalEditor.innerHTML;
      saveText();
    }
  });
  modalEditor.addEventListener('keydown', (e) => {
    if(e.key === 'Enter') {
      e.preventDefault();
      document.execCommand('insertHTML', false, '<br><br>');
      saveText();
    }
    if(e.key === 'Tab') {
      e.preventDefault();
      document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
      saveText();
    }
  });
}

// Zavření modálního okna
function closeModal() {
  modal.style.display = 'none';
}
</script>

</body>
</html>
