<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor s kódem a tlačítky pro dokumenty</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: #000;
    color: #fff;
  }
  .toolbar {
    background: #000000;
    padding: 10px;
    display: none; /* skrytý toolbar dokud není editmode */
    gap: 5px;
    flex-wrap: wrap;
    color: #fff;
  }
  .toolbar button, .toolbar select {
    padding: 5px;
    background: #000000;
    color: #fff;
    border: 2px solid #fff; /* bílé okraje */
    border-radius: 25px;
  }
  #editor {
    flex: 1;
    padding: 20px;
    border: none;
    outline: none;
    overflow-y: auto;
    background: #111; /* tmavé pozadí editoru */
    font-family: Arial, sans-serif;
    white-space: pre-wrap;
    color: #fff; /* bílé písmo v editoru */
  }
  /* Styl pro code block */
  .code-block {
    background: #1e1e1e;
    color: #d4d4d4;
    font-family: 'Courier New', monospace;
    padding: 10px;
    display: flex;
    gap: 10px;
  }
  .line-numbers {
    text-align: right;
    user-select: none;
    color: #888;
  }
  .code-content {
    white-space: pre;
  }
  /* Modální okno */
  .modal {
    display: none;
    position: fixed;
    top: 10%;
    left: 10%;
    width: 80%;
    height: 80%;
    background: #111; /* tmavé pozadí modálního okna */
    border: 2px solid #fff; /* bílé okraje */
    z-index: 1000;
    flex-direction: column;
    border-radius: 25px;
  }
  .modal-header {
    background: #222; /* tmavší hlavička */
    padding: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #fff;
    border-radius: 30px;
  }
  .modal-body {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
    border-top: 1px solid #555;
    color: #fff;
  }
  .close-btn {
    cursor: pointer;
    font-weight: bold;
  }
  .doc-btn {
    padding: 5px 10px;
    margin: 5px;
    cursor: pointer;
    color: #fff;
    background: #000000;
    border-radius: 25px;
  }
</style>
</head>
<body>

<div class="toolbar" id="toolbar">
  <button onclick="format('bold')"><b>B</b></button>
  <button onclick="format('underline')"><u>U</u></button>
  <select onchange="format('fontName', this.value)">
    <option value="">Font</option>
    <option value="Arial">Klasický</option>
    <option value="Courier New">Linux Terminal</option>
    <option value="monospace">Monospace</option>
  </select>
  <select onchange="format('fontSize', this.value)">
    <option value="">Velikost textu</option>
    <option value="1">10px</option>
    <option value="2">13px</option>
    <option value="3">16px</option>
    <option value="4">18px</option>
    <option value="5">24px</option>
    <option value="6">32px</option>
    <option value="7">48px</option>
  </select>
  <select onchange="format('foreColor', this.value)">
    <option value="">Barva textu</option>
    <option value="red">Červená</option>
    <option value="blue">Modrá</option>
    <option value="green">Zelená</option>
    <option value="black">Černá</option>
  </select>
  <button onclick="format('insertUnorderedList')">• List</button>
  <button onclick="format('insertOrderedList')">1. List</button>
  <button onclick="insertCode()">Vložit kód</button>
  <button onclick="insertDocButton()">Vložit tlačítko editoru</button>
</div>

<div id="editor" contenteditable="false"></div>

<!-- Modální okno -->
<div class="modal" id="modal">
  <div class="modal-header">
    <span id="modal-title">Nový dokument</span>
    <span class="close-btn" onclick="closeModal()">X</span>
  </div>
  <div class="modal-body" id="modal-editor" contenteditable="true"></div>
</div>

<script>
const editor = document.getElementById('editor');
const toolbar = document.getElementById('toolbar');
const modal = document.getElementById('modal');
const modalEditor = document.getElementById('modal-editor');
const modalTitle = document.getElementById('modal-title');

let currentDocId = null;

// Načtení uloženého textu při načtení stránky
window.onload = () => {
  const saved = localStorage.getItem('mainContent');
  if(saved) editor.innerHTML = saved;
};

// Formátování
function format(command, value = null) {
  if(!editor.isContentEditable) return;
  document.execCommand(command, false, value);
  saveText();
}

// Automatické ukládání
editor.addEventListener('input', () => {
  if(editor.isContentEditable) saveText();
});
editor.addEventListener('keydown', handleKeys);

// Enter a Tab
function handleKeys(e) {
  if(!editor.isContentEditable) return;
  if(e.key === 'Enter') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '<br><br>');
    saveText();
  }
  if(e.key === 'Tab') {
    e.preventDefault();
    document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
    saveText();
  }
}

// Uložení
function saveText() {
  localStorage.setItem('mainContent', editor.innerHTML);
}

// Tajný edit mode
window.editmode = () => {
  editor.setAttribute('contenteditable', 'true');
  toolbar.style.display = 'flex';
};

// Klávesová zkratka Ctrl+E na zapnutí edit mode
document.addEventListener('keydown', (e) => {
  if(e.ctrlKey && e.key.toLowerCase() === 'e') {
    e.preventDefault();
    editmode();
  }
});

// Vložení kódu
function insertCode() {
  const target = (modal.style.display === "flex") ? modalEditor : editor;
  if(!target.isContentEditable) return;

  const code = prompt("Vlož sem svůj kód:");
  if(!code) return;
  const lines = code.split('\n');
  const lineNumbers = lines.map((_, i) => i + 1).join('<br>');
  const codeHTML = `
    <div class="code-block">
      <div class="line-numbers">${lineNumbers}</div>
      <div class="code-content">${lines.join('<br>')}</div>
    </div><br>
  `;
  target.innerHTML += codeHTML;

  if (target === editor) saveText();
  else if (currentDocId) localStorage.setItem(currentDocId, modalEditor.innerHTML);
}

// Vložení tlačítka pro dokument
function insertDocButton() {
  if(!editor.isContentEditable) return;
  const name = prompt("Zadej název tlačítka:", "Nový dokument");
  if (!name) return;
  const id = "doc_" + Date.now();
  const btn = `<button class="doc-btn" onclick="openModalEditor('${id}', '${name}')">${name}</button>`;
  editor.innerHTML += btn;
  saveText();
}

// Otevření modálního editoru
function openModalEditor(id, name) {
  currentDocId = id;
  modal.style.display = 'flex';
  modalTitle.textContent = name;

  // Načti obsah
  const saved = localStorage.getItem(id);
  modalEditor.innerHTML = saved ? saved : "";

  modalEditor.oninput = () => {
    if(currentDocId) {
      localStorage.setItem(currentDocId, modalEditor.innerHTML);
    }
  };

  modalEditor.onkeydown = (e) => {
    if(e.key === 'Enter') {
      e.preventDefault();
      document.execCommand('insertHTML', false, '<br><br>');
    }
    if(e.key === 'Tab') {
      e.preventDefault();
      document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;');
    }
  };
}

// Zavření modálního okna
function closeModal() {
  if(currentDocId) {
    localStorage.setItem(currentDocId, modalEditor.innerHTML);
  }
  modal.style.display = 'none';
  currentDocId = null;
}
</script>

</body>
</html>