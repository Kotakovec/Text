<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor s Firebase</title>
<style>
  body { font-family: Arial; margin:0; padding:0; display:flex; flex-direction:column; height:100vh; background:#000; color:#fff; }
  .toolbar { background:#000; padding:10px; display:none; gap:5px; flex-wrap:wrap; color:#fff; }
  .toolbar button, .toolbar select { padding:5px; background:#000; color:#fff; border:2px solid #fff; border-radius:25px; }
  #editor { flex:1; padding:20px; border:none; outline:none; overflow-y:auto; background:#111; white-space:pre-wrap; color:#fff; }
  .code-block { background:#1e1e1e; color:#d4d4d4; font-family:'Courier New', monospace; padding:10px; display:flex; gap:10px; }
  .line-numbers { text-align:right; user-select:none; color:#888; }
  .code-content { white-space:pre; }
  .modal { display:none; position:fixed; top:10%; left:10%; width:80%; height:80%; background:#111; border:2px solid #fff; z-index:1000; flex-direction:column; border-radius:25px; }
  .modal-header { background:#222; padding:5px; display:flex; justify-content:space-between; align-items:center; color:#fff; border-radius:30px; }
  .modal-body { flex:1; padding:10px; overflow-y:auto; border-top:1px solid #555; color:#fff; }
  .close-btn { cursor:pointer; font-weight:bold; }
  .doc-btn { padding:5px 10px; margin:5px; cursor:pointer; color:#fff; background:#000; border-radius:25px; }
</style>
</head>
<body>

<div class="toolbar" id="toolbar">
  <button onclick="format('bold')"><b>B</b></button>
  <button onclick="format('underline')"><u>U</u></button>
  <select onchange="format('fontName', this.value)">
    <option value="">Font</option>
    <option value="Arial">Klasick√Ω</option>
    <option value="Courier New">Linux Terminal</option>
    <option value="monospace">Monospace</option>
  </select>
  <select onchange="format('fontSize', this.value)">
    <option value="">Velikost textu</option>
    <option value="1">10px</option>
    <option value="2">13px</option>
    <option value="3">16px</option>
    <option value="4">18px</option>
    <option value="5">24px</option>
    <option value="6">32px</option>
    <option value="7">48px</option>
  </select>
  <select onchange="format('foreColor', this.value)">
    <option value="">Barva textu</option>
    <option value="red">ƒåerven√°</option>
    <option value="blue">Modr√°</option>
    <option value="green">Zelen√°</option>
    <option value="black">ƒåern√°</option>
  </select>
  <button onclick="format('insertUnorderedList')">‚Ä¢ List</button>
  <button onclick="format('insertOrderedList')">1. List</button>
  <button onclick="insertCode()">Vlo≈æit k√≥d</button>
  <button onclick="insertDocButton()">Vlo≈æit tlaƒç√≠tko editoru</button>
  <button style="margin-left:auto;" onclick="saveMainContent()">üíæ Ulo≈æit & Zav≈ô√≠t</button>
</div>

<div id="editor" contenteditable="false"></div>

<div class="modal" id="modal">
  <div class="modal-header">
    <span id="modal-title">Nov√Ω dokument</span>
    <span class="close-btn" onclick="closeModal()">X</span>
  </div>
  <div class="modal-body" id="modal-editor" contenteditable="true">
    <button style="margin-top:10px;" onclick="saveModalDoc()">üíæ Ulo≈æit & Zav≈ô√≠t</button>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDGmaBUXKgFq1mPuSIi4_DY6xUycwNGnKE",
  authDomain: "textovy-dokument.firebaseapp.com",
  projectId: "textovy-dokument",
  storageBucket: "textovy-dokument.appspot.com",
  messagingSenderId: "207844729713",
  appId: "1:207844729713:web:464c37fbde39a43aec0cd0",
  measurementId: "G-XS4PLS2G01"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const editor = document.getElementById('editor');
const toolbar = document.getElementById('toolbar');
const modal = document.getElementById('modal');
const modalEditor = document.getElementById('modal-editor');
const modalTitle = document.getElementById('modal-title');
let currentDocId = null;

// Naƒçten√≠ hlavn√≠ho obsahu z Firestore
async function loadMainContent() {
  const docRef = doc(db, "editor", "mainContent");
  const docSnap = await getDoc(docRef);
  if(docSnap.exists()) {
    editor.innerHTML = docSnap.data().content;
  }
}
loadMainContent();

// Form√°tov√°n√≠
function format(command, value = null) {
  if(!editor.isContentEditable) return;
  document.execCommand(command, false, value);
}

// Enter a Tab
editor.addEventListener('keydown', e => {
  if(!editor.isContentEditable) return;
  if(e.key === 'Enter') { e.preventDefault(); document.execCommand('insertHTML', false, '<br><br>'); }
  if(e.key === 'Tab') { e.preventDefault(); document.execCommand('insertHTML', false, '&nbsp;&nbsp;&nbsp;&nbsp;'); }
});

// Hlavn√≠ obsah ulo≈æit a zav≈ô√≠t editor
async function saveMainContent() {
  await setDoc(doc(db, "editor", "mainContent"), {content: editor.innerHTML});
  editor.setAttribute('contenteditable', 'false');
  toolbar.style.display = 'none';
}

// Edit mode
window.editmode = () => { editor.setAttribute('contenteditable','true'); toolbar.style.display='flex'; };
document.addEventListener('keydown', e => { if(e.ctrlKey && e.key.toLowerCase()==='e'){ e.preventDefault(); editmode(); } });

// Vlo≈æen√≠ k√≥du
function insertCode() {
  const target = (modal.style.display==="flex") ? modalEditor : editor;
  if(!target.isContentEditable) return;
  const code = prompt("Vlo≈æ sem sv≈Øj k√≥d:");
  if(!code) return;
  const lines = code.split('\n');
  const lineNumbers = lines.map((_, i)=>i+1).join('<br>');
  const codeHTML = `<div class="code-block"><div class="line-numbers">${lineNumbers}</div><div class="code-content">${lines.join('<br>')}</div></div><br>`;
  target.innerHTML += codeHTML;
}

// Vlo≈æen√≠ dokumentu
function insertDocButton() {
  if(!editor.isContentEditable) return;
  const name = prompt("Zadej n√°zev tlaƒç√≠tka:", "Nov√Ω dokument");
  if(!name) return;
  const id = "doc_" + Date.now();
  const btn = `<button class="doc-btn" onclick="openModalEditor('${id}','${name}')">${name}</button>`;
  editor.innerHTML += btn;
}

// Otev≈ôen√≠ mod√°ln√≠ho editoru
async function openModalEditor(id, name) {
  currentDocId = id;
  modal.style.display = 'flex';
  modalTitle.textContent = name;
  const docRef = doc(db, "documents", id);
  const docSnap = await getDoc(docRef);
  modalEditor.innerHTML = docSnap.exists() ? docSnap.data().content : "";
}

// Ulo≈æen√≠ dokumentu z mod√°lu a zav≈ôen√≠
async function saveModalDoc() {
  if(!currentDocId) return;
  await setDoc(doc(db, "documents", currentDocId), {content: modalEditor.innerHTML});
  modal.style.display = 'none';
  currentDocId = null;
}

// Zav≈ôen√≠ mod√°lu bez ukl√°d√°n√≠
function closeModal(){ modal.style.display='none'; currentDocId=null; }

</script>
</body>
</html>